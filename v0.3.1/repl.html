<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>repl &mdash; Node.js &mdash; Документация</title>
  <link rel="stylesheet" href="assets/style.css" type="text/css" media="all" />
  <link rel="stylesheet" href="assets/sh.css" type="text/css" media="all" />
  <script type="text/javascript" src="assets/jquery.js"></script>
</head>
<body>
  <div id="container">
    <header>
      <h1>Node.js &mdash; Документация</h1>
      <div id="gtoc">
        <p><a href="index.html">Содержание</a> | <a href="all.html">Просмотреть на одной странице</a></p>
      </div>
      <hr />
    </header>
    <h2 id="_">Интерактивная консоль (REPL)</h2>

<p>Интерактивная консоль (Read-Eval-Print-Loop, REPL) доступна как самостоятельная
программа и может включаться в другие скрипты. REPL предоставляет возможность
интерактивно выполнять JavaScript и сразу видеть результат. Он может использоваться
для отладки, тестирования, и просто знакомства с системой.</p>

<p>Выполняя <code>node</code> без аргументов из командной строки вы попадёте прямо в REPL.
В нём есть простое редактирование строк по образцу emacs.</p>

<pre><code>mjr:~$ node
Type '.help' for options.
node&gt; a = [ 1, 2, 3];
[ 1, 2, 3 ]
node&gt; a.forEach(function (v) {
...   console.log(v);
...   });
1
2
3</code></pre>

<p>Чтобы использовать продвинутые редакторы, запустите Node с переменной окружения
<code>NODE_NO_READLINE=1</code>. Это запустит REPL с обычными терминальными настройками,
позволяющими использовать <code>rlwrap</code>.</p>

<p>К примеру, можно добавить следующее к Вашему файлу bashrc:</p>

<pre><code>alias node="env NODE_NO_READLINE=1 rlwrap node"</code></pre>

<h3 id="repl.start_">repl.start(prompt='node&gt; ', stream=process.openStdin())</h3>

<p>Запускает REPL с <code>prompt</code> в качестве приглашения и потоком <code>stream</code> для ввода/вывода.
Параметр <code>prompt</code> необязателен и по умолчанию принимает значение <code>'node&gt;'</code>.
Параметр <code>stream</code> также необязателен и по умолчанию принимает значение <code>process.openStdin()</code>.</p>

<p>В одном экземпляре node могут быть запущены несколько консолей REPL.
Все будут использовать один глобальный объект но разный ввод-вывод.</p>

<p>Вот пример, запускающий консоль REPL на стандартном потоке ввода-вывода,
сокете Unix, и TCP-сокете:</p>

<pre><code>var net = require("net"),
    repl = require("repl");

connections = 0;

repl.start("node via stdin&gt; ");

net.createServer(function (socket) {
  connections += 1;
  repl.start("node via Unix socket&gt; ", socket);
}).listen("/tmp/node-repl-sock");

net.createServer(function (socket) {
  connections += 1;
  repl.start("node via TCP socket&gt; ", socket);
}).listen(5001);</code></pre>

<p>Запуск этой программы из командной строки запустит консоль на <code>stdin</code>. Другие
клиенты могут подключаться через Unix-сокет или TCP-сокет. Для подключения
к TCP сокетам можно использовать <code>telnet</code>, a <code>socat</code> можно использовать
для обоих типов сокетов.</p>

<p>Запуская REPL на сокете вместо стандартного ввода-вывода Вы можете подключаться
к работающему процессу node не перезапуская его.</p>

<h3 id="_REPL">Возможности REPL</h3>

<p>Внутри REPL Control+D завершает его работу. Можно вводить многострочные выражения.</p>

<p>Специальная переменная <code>_</code> (знак подчёркивания) содержит результат последнего выражения.</p>

<pre><code>node&gt; [ "a", "b", "c" ]
[ 'a', 'b', 'c' ]
node&gt; _.length 
3
node&gt; _ += 1
4</code></pre>

<p>REPL предоставляет доступ к любым переменным глобальной области видимости.
Вы можете явно передать переменную в REPL, присвоив её объекту <code>context</code>,
ассоциированному с каждым экземпляром <code>REPLServer</code>. Например:</p>

<pre><code>// repl_test.js
var repl = require("repl"),
    msg = "message";

repl.start().context.m = msg;</code></pre>

<p>Свойства объекта <code>context</code> выглядят внутри REPL как локальные:</p>

<pre><code>mjr:~$ node repl_test.js
node&gt; m
'message'</code></pre>

<p>В REPL есть несколько специальных команд:</p>

<ul><li><code>.break</code> - При вводе многострочного выражения иногда можно ошибиться,
либо совсем отказаться от его ввода. <code>.break</code> начнёт ввод заново.</li><li><code>.clear</code> - Сбрасывает объект <code>context</code> в пустой и очищает введённое многострочное выражение.</li><li><code>.exit</code> - Закрывает потоки ввода-вывода, принуждая REPL завершиться.</li><li><code>.help</code> - Показывает список специальных команд.</li></ul>
  </div>
  <script type="text/javascript" src="assets/sh_main.js"></script>
  <script type="text/javascript" src="assets/sh_javascript.min.js"></script>
  <script type="text/javascript" src="assets/core.js"></script>
</body>
</html>

